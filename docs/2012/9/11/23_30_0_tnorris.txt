bnoordhuis: here's my code before we started talking: https://github.com/trevnorris/deluged/blob/master/src/reader.js#L25-47
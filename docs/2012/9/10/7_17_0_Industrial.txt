I'm now trying to reimplement this using kriskowal/q https://gist.github.com/4d398071828ca77d6db7
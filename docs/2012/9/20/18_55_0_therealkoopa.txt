do you think it's best to use something like proxyquire or to have a db module that returns a test instance if NODE_ENV=test/testing? I can see both ways. I don't like putting 'test' code in production stuff, meaning I don't really like: if (mode == test) {} 
konobi: my implementation is so far 200LOC his is 1400LOC, and it's kind of hairy!
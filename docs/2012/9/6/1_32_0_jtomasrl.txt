I dont know if this is the best way of doint it, but its something like this: https://gist.github.com/3649675
samholmes: you can just use callbacks to close over all the state you need
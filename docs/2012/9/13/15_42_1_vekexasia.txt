So i thought using an atomic queue could be a solution
i have a feeling its related to the streams not getting flushed
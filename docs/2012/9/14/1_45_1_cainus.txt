usually I extract functions when it gets hairy
nsm: code is pretty big, ~500+ lines...
rzsz: or move your fs.close() inside the read() callback and use a counter to determine when you're done
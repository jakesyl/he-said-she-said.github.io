threads make writing reusable libraries so difficult
i currently have something like http://pastie.org/4753494
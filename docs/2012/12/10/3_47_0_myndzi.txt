tryin to port some code that was written in C#, and it looks like it's close to working but i can't see what's wrong
http://pastebin.com/dXAQw8hM But the code is a mess.
I feel like it's pretty close, I'm just messing up something silly with the memory handling
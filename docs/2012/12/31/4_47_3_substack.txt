use named functions, modules, and events to flatten nested logic
Use monads. Oh wait, wrong language.
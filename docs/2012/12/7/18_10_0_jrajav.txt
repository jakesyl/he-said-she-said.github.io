darrenlooby: Change it so that the function is a proper function rather than something that changes global state
perhaps buf.copy on itself
Raynos: i think the biggest chnage required is to treat a non-buffer/non-string as alwyas having a length=1 if it doesn't have a lenght property
ive written something that probably wont directly work for your needs, but it might give some insight into how it might be done
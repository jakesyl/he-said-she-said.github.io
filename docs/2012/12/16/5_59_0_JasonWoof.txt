this might be more appropriately done as a code generator
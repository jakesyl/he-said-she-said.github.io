I want to write a potentially long-running loop such that it cedes to any other operations on each iteration
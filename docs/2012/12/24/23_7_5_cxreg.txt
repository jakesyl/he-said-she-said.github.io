bnoordhuis: there's some funky behavior with domains if you exit one that's in the domain stack more than once.. i'm playing with a patch that puts a unique id in the stack along with the domain itself, which you can pass to exit.  sound like a useful patch?
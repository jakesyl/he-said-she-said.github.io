Is there any way to perform the function call on line 23 synchronously? http://pastebin.com/FCPFVVcJ
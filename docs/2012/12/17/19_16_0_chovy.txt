but the code was very difficutl to follow the chain of events
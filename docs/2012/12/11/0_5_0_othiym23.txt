it might require some reworking of your code (and yeah, running into this problem generally means you're not really thinking in async yet), but the result should be clean and easy to understand
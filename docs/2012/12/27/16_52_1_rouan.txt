if scale is an issue perhaps you can do that processing client side
the real key is the sni_check function
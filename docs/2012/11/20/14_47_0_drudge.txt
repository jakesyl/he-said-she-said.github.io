boutell: you could use mongoose's code https://github.com/LearnBoost/mongoose/blob/master/lib/connection.js#L143
The general idea is one can pipe X to Y to Z, and if Z returns false then Y will be paused, at which point X's next write will get false and it'll pause itself, and then when Z is OK again it'll emit drain and Y will be unpaused and emit drain and X will unpause.
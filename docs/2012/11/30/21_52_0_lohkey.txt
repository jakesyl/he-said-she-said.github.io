lexical scope and closures are your friends, use them
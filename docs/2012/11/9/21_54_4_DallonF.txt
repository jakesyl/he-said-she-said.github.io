It's like it's emitting 'end' too early
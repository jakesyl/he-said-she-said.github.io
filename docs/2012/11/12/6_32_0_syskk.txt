there's probably a few open source libraries that can do that, i suggest you look how they do this
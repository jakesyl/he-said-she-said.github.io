i implemented a middleware pattern someone helped me with before, but i got some weird results where the result of one function is injected  in another function
this way might be easier on you:  http://howtonode.org/testing-private-state-and-mocking-deps
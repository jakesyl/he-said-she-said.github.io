If I have the following code: http://pastebin.com/L2QrGLmw
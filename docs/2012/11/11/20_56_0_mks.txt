your problems are related to code structure in general
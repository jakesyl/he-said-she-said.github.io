Ah, that was nice. Entire registration code in like 40 lines and it's async.
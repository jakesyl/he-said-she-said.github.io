Yeah. Your Makefile is forcing NODE_ENV=test when you call `make test`. `npm test` is calling `make test`, so it's always forcing NODE_ENV=test.
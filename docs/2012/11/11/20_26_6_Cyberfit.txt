lacksme: regardless of the code, I think you could make it more readable. Right now things are moving around a lot without proper tabbing
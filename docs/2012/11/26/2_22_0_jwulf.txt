without async what you need to do here is break your different steps into separate functions
rump: read carefully. i mean your var compress = function(buf) { ... } should take a cb
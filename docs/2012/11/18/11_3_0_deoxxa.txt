dissolve could be largely moved to a code generation kind of model, and concentrate could be sped up a bit in some cases by pre-allocating large buffers then trimming them down, instead of precalculating the required length of the buffer
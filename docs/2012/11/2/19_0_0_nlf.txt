i really want to find a better way to implement waiting for a reply on a socket before sending the next packet
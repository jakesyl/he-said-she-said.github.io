I'm obviously failing to understand middleware (again)
josephsaliba: you're passing a callback to flushNewProducts which gets called _once_ in your writeFile callback
josephsaliba: you can't "return only when flushNewProducts is done" if it's async. what you can do is pass in a callback
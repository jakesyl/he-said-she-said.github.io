Is it possible that the db calls are finishing after the end is emitted?
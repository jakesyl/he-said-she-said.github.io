writing tests after the fact is painful
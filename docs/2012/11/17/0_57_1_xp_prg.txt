single threaded manual context switching madness
xp_prg: At this point you see how closures in ECMAScript work, and you should be able to figure out how to integrate this into your code and adapt it to your needs
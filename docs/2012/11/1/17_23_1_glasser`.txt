hmm, i guess i can just pass a callback to stream.end, not that this is documented
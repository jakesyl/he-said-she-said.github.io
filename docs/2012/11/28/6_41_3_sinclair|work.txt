mdedetrich: not sure how middleware leads to a module acting as a function
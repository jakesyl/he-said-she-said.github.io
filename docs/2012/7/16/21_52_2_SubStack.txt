it's old battle-hardened code with lots of special cases and exceptions and messy bugfixes
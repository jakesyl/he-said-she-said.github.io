tnorris: If I pushed the buf declaration up a scope, then you would run into problems.
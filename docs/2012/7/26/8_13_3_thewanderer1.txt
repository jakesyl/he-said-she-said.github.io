splitting the algorithm part from the state part might work - thanks! I'll look into this.
upstream: check out github/iriscouch/txn for inspiration
closing over all the state variables
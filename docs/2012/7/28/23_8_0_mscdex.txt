diverdude: or you can pull out logic into separate named functions, or you can use a flow control module like `async`
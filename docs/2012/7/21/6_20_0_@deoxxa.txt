well i've used https://github.com/mafintosh/buffoon for that
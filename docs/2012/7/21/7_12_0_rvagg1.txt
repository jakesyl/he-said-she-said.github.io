the approach I take is to put most of the complexity into the JS abstraction layer, so your C++ can be straightforward and not have to do too much error checking, makes it much simpler
http://pastie.org/pastes/4355181/text
but of course anything that involves IoC in C is a disaster
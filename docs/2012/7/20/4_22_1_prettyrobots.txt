This sounds like an interesting library to write.
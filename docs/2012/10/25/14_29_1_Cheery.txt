with iterators and maybe coroutines
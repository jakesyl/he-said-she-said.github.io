Almindor: i'd scour the passport source for something that looks like connect middleware
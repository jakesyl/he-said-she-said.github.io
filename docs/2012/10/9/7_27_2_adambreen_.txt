@chovy: why are you implementing checkPermission as middleware?
nlf: here's my implementation. I opted for extending the native Stream. worked easier that way: https://github.com/trevnorris/deluged/blob/master/lib/segp.js
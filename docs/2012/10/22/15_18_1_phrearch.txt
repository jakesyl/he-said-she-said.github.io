does anyone know about how to write middleware patterns?
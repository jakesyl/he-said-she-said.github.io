code refactory in node is a disaster, kudos callbacks
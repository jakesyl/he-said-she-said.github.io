That I understand. How do I wait for the results of the queries before I call the template function?
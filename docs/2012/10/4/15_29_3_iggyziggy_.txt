ok, so i should rewrite it to async, how does that work with shared memory?
and i need to put it inside a closure to get the right loop instance
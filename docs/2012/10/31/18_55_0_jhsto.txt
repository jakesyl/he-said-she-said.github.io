spion, I did not completely understand what you tried to tell me. Here's the code: https://gist.github.com/3989086
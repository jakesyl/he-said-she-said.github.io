Feel free to review my code, I'm about to go insane:  http://pastie.org/5143836
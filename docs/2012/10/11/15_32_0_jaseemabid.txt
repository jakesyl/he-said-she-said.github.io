hdon, http://pastebin.com/HtQjvSsp works on master
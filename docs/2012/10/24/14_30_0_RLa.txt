basically it unrolls the loop into a chain of callbacks
control flow is just too hard with node.js comparing to other languages :-)
https://github.com/LearnBoost/socket.io/blob/master/lib/socket.js#L151
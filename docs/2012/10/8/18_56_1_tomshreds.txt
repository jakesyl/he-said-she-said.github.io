Here's how I implemented it: https://github.com/Brainpad/ThinAir/blob/master/libs/server.js
i tend to write something like this: https://gist.github.com/8d7095883f740d4e8843
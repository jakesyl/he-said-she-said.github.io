how can i make this works? https://gist.github.com/eba60b96d6c599d9c26e
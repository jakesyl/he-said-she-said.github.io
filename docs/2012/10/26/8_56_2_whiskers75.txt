this code is driving me up the wall. https://gist.github.com/3957717
https://gist.github.com/3883871  and  https://gist.github.com/3883978
niggler: PHP has horrible, horrible edge cases that don't map to JS at all neatly.
so .each() gets called, and then directly afterwards you call response.end() even though you may not be finished
ok, lemme fork that gist and add some comments about what's happening at each point
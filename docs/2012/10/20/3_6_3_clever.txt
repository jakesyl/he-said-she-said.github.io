i eventualy traced it to some array operations not doing what i expected
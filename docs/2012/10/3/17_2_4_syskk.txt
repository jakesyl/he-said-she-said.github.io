well, here's how i solved the problem in case anyone's curious : https://gist.github.com/3828324
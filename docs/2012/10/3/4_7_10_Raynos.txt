jmoyers: the implementation is ugly. The API surface is clean (https://gist.github.com/3791742 )
superjoe: might want to check out the code, otherwise your gist is probably the right way to do it
You can see Suckle for a working example of this https://github.com/Weltschmerz/Suckle/blob/master/lib/suckle.js
updated the gist with the new code, including the on error, console output and curl output
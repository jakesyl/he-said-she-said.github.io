http://pastebin.com/YkwjCbiW - with vars
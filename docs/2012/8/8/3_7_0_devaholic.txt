the if/else inside async thread makes me sad
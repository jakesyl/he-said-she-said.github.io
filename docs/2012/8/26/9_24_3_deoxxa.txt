the npm code was rather twisty and turny last time i saw it
what is the most effective way to do an asynchronous for loop?
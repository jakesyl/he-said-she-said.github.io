Coding async is harder than I thought
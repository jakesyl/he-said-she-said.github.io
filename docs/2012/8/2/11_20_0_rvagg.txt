pdgreen: perhaps you should use a lib like 'async'
i want to avoid race conditions, and i can tell that the way i'm doing it right now is an unholy mess.
either set a flag, or use promises
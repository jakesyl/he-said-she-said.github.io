it's not possible to do a completely atomic generate-temp-file-path plus open-file operation, in any language, I would think.
this is more an issue of how you're handling state than a race condition per se
it's just html templating, so in the first pass I cache the offsets and lengths around the data to be written, and next pass I just write from those offsets
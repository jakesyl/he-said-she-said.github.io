this is actually really easy to do in a single process, because if you require a module, that module knows it was required (module.parent !== undefined)
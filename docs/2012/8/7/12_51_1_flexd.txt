JS version actually posted in a gist :)
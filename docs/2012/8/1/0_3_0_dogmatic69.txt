My first attempt http://paste.ubuntu.com/1122481/
is there a better way to write this? http://pastie.org/4580935
is there a better way to write this? it seems like a lot of boilerplate just to stream something to disk: http://pastie.org/4581079
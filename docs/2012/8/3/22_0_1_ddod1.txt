I tried out async, but it seems to be about as much code as using recursive functions
it feels like there will always be a race condition :(
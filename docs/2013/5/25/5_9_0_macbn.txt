it seems that the loop continues even after the callback
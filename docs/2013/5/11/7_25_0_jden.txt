write it clean. then write unit tests. them benchmark. then optimize, making sure not to introduce regressions.
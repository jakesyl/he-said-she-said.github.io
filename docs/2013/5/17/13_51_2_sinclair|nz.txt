foofoobar: how can i code this better ? http://pastebin.com/Kyd4pjxZ
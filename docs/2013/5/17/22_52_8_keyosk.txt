Since err will return early you need to handle the counter increment there too..
foofoobar: implementation looks like this http://pastebin.com/kneXygyY
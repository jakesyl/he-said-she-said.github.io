since it's websockets, can't you just proxy the http header from that, and fill in x-forwarded-for ?
The gist is https://gist.github.com/tankbusta/30f113549e47a9aa763e - apologize for the indentation
there's a lot more to the program, but I think this is the relevant parts: https://gist.github.com/CorbinDallas/5674508
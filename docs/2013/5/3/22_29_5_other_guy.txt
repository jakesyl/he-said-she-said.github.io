I use setImmediate to fake TCO
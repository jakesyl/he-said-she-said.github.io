how should the server know that after three messages received the transaction is over ?
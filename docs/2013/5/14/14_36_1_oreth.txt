the ProcessHashQueue function is what seems to lock everything
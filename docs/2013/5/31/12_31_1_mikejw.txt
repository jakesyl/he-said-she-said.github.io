zomg: but what if that async code itself is within a function?
my bash foo needs a bit of work, but that's the gist
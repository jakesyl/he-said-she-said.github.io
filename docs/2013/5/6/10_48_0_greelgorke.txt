var envelope_buffer = new Buffer(buffer_blob + 4); creates probably not what you want
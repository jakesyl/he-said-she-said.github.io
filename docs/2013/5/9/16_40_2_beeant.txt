JS error somehow motivates me to refactor even more
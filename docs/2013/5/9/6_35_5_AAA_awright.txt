I tried something similar with Spidermonkey... Which is just a horrible, horrible API
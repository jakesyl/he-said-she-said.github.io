promises and streams solved this problem already so you can just take a look and grab the parts that you need
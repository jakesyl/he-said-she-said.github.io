in that example, a more robust state machine for iterators would be all you really need, and the convention that the last argument is a callback
I think it should be a middleware as it clearly don't depend on routing, but apparently it's still run before some rules, so the page is partially rendered, then I have a refresh to the login page. :/
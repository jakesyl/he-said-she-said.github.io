i ended up just writing it using async.series instead
marahin: While loops don't play nice in Node.js
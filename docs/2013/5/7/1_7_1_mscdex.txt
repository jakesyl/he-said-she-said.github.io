Promises/C for a non-OO API
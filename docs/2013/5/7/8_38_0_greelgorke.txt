before filter should be just fine, attach the events there and call compounds next function in the end-handler
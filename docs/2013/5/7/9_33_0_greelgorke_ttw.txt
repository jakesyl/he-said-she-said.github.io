with this setup your middleware is called before anything happens. is your before filter still there?
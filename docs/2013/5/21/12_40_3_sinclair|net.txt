isaacbw: this seems to work... http://pastebin.com/reYSWj0p
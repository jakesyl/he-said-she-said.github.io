which will dogfood the state monad to let you write programs like you described
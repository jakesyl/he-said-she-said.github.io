writing a plain C service
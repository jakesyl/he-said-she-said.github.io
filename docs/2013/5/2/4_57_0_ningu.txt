I wonder if you could make a low-level middleware and wrap it in the connect api, so you could use it either way
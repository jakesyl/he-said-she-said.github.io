shayanjm: split things up into separate modules as much as possible
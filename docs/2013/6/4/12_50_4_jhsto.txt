the end event has to be declared before the pipe
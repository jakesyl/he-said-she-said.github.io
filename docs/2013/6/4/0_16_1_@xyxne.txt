knee deep in node internals
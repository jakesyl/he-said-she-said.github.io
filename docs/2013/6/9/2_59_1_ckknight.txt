this is what I have now, which doesn't work: https://gist.github.com/ckknight/8470a7d19f12fd74cd7d
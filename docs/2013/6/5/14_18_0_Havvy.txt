Note: This is completely untested code.
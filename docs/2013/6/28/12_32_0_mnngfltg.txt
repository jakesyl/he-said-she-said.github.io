zomg, in Python, I'd simply use something like http://pastebin.com/9RXG0L8b (pseudocode)
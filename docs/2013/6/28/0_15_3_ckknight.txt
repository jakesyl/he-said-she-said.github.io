in GorillaScript, I use a state machine with a while and a switch
trying to figure out how to optimize some code
can callback(null, ids); be inside the callback function for msq.query? because doing without call backs like id = mysql(query); sets stuff withouit insertId
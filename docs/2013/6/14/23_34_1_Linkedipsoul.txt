http://pastie.org/pastes/8044348/text
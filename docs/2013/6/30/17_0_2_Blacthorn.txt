Try moving console.log(!!response) into the foreach to ensure that it is still defined? 
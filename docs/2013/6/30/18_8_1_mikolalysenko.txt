it is difficult to pull out just the generated code for this example though since it interacts with a number of other systems
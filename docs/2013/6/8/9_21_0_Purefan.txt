Ok here is some code, not functional though but it illustrates my problem http://pastebin.com/gffH0VHS
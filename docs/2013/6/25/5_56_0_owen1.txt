after staring at the code for 10 minutes i think i have some clues. here is what i think is going on there:
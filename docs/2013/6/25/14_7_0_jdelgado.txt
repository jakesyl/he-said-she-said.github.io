Well I can tell you one thing that is really funky, you are executing it in line - which means it wont run every time someone requests something
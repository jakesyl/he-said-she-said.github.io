the code looks really ugly btw.
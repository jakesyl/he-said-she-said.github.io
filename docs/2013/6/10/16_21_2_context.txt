or instead of implementing your own maybe fix socket.io's c++ client and send a pull request
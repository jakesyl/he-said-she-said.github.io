then you just need to keep track of the state for each connection
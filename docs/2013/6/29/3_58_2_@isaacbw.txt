look at the middleware that ships with it and see how they work
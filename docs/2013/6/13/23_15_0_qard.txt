Here's a copy/paste of the relevant stuff; https://gist.github.com/Qard/c5e1bcd9e294add91dcf
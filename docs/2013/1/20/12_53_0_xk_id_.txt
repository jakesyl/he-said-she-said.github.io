https://gist.github.com/4578423 <-- how can I make sure that the array is returned *after* it was filled?
squeakytoy: http://stackoverflow.com/questions/9563983/testing-node-js-mock-out-and-test-a-module-that-has-been-required uses a crazy approach where you're creating a VM for each module you want to test. but i think that's way too complex.
squeakytoy: you're still calling through to the original require. my suggestion IS dependency injection, because you're mocking the require to B so that you're only testing one thing at a time.
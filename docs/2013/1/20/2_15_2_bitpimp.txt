just the code at https://gist.github.com/4576240 ... 
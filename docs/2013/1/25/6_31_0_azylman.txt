I knew reading mongoose's source code would come in handy some day
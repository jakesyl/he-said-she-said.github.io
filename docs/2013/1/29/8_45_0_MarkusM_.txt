My var socket scope might be wrong in the anonymous function.
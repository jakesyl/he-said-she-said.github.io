all our code is using `when` now as far as possible 
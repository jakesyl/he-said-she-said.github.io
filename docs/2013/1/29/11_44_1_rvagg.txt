the `if (idx+1===accounts.length)` line is your problem, there's absolutely no guarantee that the last one will come back last
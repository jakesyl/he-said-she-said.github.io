before usernames[socket.room] etc. add if(!usernames[socket.room]) { usernames[socket.room] = {} ); to the line before
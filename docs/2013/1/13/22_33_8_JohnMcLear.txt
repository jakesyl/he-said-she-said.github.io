console.log(haystack.match(/foo/g).length); // 3
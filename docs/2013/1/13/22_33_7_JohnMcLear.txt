console.log(haystack.match(needle, 'g').length); // 1 <-- should be 3
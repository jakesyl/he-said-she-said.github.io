rvagg: even when it works, it's super complicated and hard to follow the code.
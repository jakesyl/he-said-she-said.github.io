https://github.com/joyent/node/blob/v0.8.18/lib/stream.js
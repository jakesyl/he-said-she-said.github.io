shared state and threading is a non-trivial problem
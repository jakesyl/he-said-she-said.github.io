well for one thing you're having createServer listen to app before it's initialized
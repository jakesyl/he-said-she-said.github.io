with sharing of global variables
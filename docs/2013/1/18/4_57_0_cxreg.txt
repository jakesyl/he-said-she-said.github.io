isaacs: re-filed PR as https://github.com/joyent/node/pull/4621, with test, against master
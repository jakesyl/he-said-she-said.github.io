spion, I see how the promises API might look the cleanest in this case.
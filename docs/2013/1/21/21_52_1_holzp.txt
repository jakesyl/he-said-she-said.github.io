this is tricky because of the async nature of the code
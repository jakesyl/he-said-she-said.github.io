jtomasrl: node goes through the instructions asynchronously. so you need a way to wait until it connects, before you allow moving onto the next instructions.
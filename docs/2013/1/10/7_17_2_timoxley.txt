xp_prg3 you might want to consider using a lib like async to handle the loops https://github.com/caolan/async#forEach
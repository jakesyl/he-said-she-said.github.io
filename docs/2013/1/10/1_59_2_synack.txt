I think the ENOTSOCK != EINVAL assertion is just a bug in the test... ENOTSOCK seems like the right thing to be throwing in the case of fd 0
vkruoso: you probably want to open then file with sync flags and write within the callback
I will try to figure out how the OS level does it -- ipset in particular seems good -- claims good space efficiency and O(1) lookup somehow
how do I "Use a mutex or rwlock to ensure accesses are performed in the right order."
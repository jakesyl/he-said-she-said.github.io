ChrisPartridge, here's a snippet: https://gist.github.com/superjoe30/5166299
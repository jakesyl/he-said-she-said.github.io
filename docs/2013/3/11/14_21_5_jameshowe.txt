everything is fine when processEvent is called from the main thread
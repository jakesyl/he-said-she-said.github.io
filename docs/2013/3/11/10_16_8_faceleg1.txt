guidocalvano: this code was ... confusing when I started
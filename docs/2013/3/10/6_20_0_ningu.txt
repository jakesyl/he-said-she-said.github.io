adamramadhan: for example, use an async.each(). and when that each is finished -- there's a callback for that -- *then* write the file.
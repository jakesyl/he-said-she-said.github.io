I can't figure out the control logic / hierarchy of what I'm trying to do: https://gist.github.com/ganzuul/5130410
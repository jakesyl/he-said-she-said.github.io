you should check for memory leaks too, what with all of your mallocs :P
the usual solution is to use two parallel worker queues, one for unallocated tasks and one for allocated
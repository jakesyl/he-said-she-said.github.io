there's a lot of magic in that function
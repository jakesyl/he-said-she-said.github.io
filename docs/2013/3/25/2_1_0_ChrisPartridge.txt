sshaginyan: all this stuff comes straight from the http implementation in node
Paccc: You need to execute the connection.query in your callback, that's the only way to ensure that the query will execute *after* the connection is made.
Here's my code: http://hastebin.com/kurukowavo.coffee
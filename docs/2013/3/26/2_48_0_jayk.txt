See above.  the waitfor thing I describe would do what you want in 10 lines of code or less.
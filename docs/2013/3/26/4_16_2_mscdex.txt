here's what i ended up with for the kind of stream i had in mind: https://gist.github.com/mscdex/5243078
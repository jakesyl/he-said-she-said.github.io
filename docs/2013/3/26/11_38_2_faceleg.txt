converting C++ methods that did their C calls on the main thread to methods that performed the calls on diff threads and called callback
my code is at http://www.hastebin.com/xehohebequ.coffee
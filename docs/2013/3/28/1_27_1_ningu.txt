and only needed a very small amount of manual sql generation
AAA_awright: if your function is that complex, split it up into multiple functions.
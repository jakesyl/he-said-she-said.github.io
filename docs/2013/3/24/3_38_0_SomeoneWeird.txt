use async then, and just run the async stuff first then run the sync in the callback
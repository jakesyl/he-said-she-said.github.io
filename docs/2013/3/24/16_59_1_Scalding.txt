in your example, websocket will be undefined when the function is called
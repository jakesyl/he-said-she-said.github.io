nathan7: give me 5 minutes. i'll rewrite it with async.each
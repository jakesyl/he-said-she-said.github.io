it is surprisingly complicated to build a decent chat thing with socket.io
Ok, so, I suspect it's failing because it tries to create the pipes with O_CLOEXEC (valid since 2.6.23) but my kernel is 2.6.18 - changing the relevant function's #if __linux__ to #if 0 so it goes ahead and uses the pipe() function fixes the issue.
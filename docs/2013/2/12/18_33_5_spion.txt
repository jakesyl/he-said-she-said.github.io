there is a way to simplify this code and use callbacks.
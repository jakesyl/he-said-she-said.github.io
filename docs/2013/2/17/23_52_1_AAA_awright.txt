What you're asking isn't particularly unique, you get the HTTP headers, and at any time you decide when you want to make the response, even if you haven't gotten the 'end' event yet
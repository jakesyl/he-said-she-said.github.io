xinmin: what happens if you replace setTimeout with process.nextTick?
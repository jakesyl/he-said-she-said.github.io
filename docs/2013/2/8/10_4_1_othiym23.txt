it looks like I have to do it using recursion rather than chaining the promises?
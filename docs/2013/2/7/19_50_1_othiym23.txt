well, this is for a test framework, so it's OK if the code is a little inelegant
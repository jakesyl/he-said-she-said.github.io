is there any way to get around using deferred() there?
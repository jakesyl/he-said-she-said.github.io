jtomasrl: its a little hard to follow, maybe you should write up the details in a gist
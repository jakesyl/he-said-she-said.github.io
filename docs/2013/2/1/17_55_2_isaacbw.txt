here we go: http://hastebin.com/hofayelefe.vhdl
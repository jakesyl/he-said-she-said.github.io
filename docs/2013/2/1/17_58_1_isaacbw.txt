I was hoping there would be a way to combine routing and logic functions into a neat data structure, but I guess this works
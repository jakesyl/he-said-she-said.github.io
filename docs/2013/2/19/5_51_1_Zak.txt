the bits that don't, I had to obsfucate to get past jslint
samholmes: there are a lot of ways to avoid multiple loops
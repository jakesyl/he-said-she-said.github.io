I also forgot the return statement in a few places because I'm used to CoffeeScript
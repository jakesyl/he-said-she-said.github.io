with named functions and lots of streams
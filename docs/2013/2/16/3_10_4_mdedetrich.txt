turned out using threads had better performance
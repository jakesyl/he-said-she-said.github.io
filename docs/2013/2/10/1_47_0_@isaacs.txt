ememe: read through lib/module.js as well.  there are some not-public but very-stable bits you can lift or use.
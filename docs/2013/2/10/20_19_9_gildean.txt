the code is totally messy, but works
asturel: then the gist above is pretty much what you need, you'll want to add some sugar for your use case but the basics are there.
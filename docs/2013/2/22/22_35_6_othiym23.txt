and SmartOS + DTrace is probably the best solution for ad hoc profiling -- it's a pain in the ass to learn, but it gives you a ton of control
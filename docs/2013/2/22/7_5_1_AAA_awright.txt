sshaginyan: You had it mostly right up here http://pastie.org/6314860
Can anyone help me refactor that filter function to work?
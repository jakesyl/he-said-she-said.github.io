a lot of if cluster.isMaster feckery, etc.
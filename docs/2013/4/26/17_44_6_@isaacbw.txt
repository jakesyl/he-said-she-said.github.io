the branch I linked has __APPLE__ guards
i'm gonna put up a pseudo code gist in a min
The GIST I sent you is my total code
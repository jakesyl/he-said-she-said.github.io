Ritzton: use an anonymous function or write a function that returns a closure with access to the socket
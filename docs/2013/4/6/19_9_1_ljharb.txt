using an integer flag feels really brittle to me
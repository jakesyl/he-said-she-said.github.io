marshall: https://gist.github.com/eddyb/5420427
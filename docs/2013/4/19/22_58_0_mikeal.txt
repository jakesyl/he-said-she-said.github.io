moving this all to browserify will be a really big change :)
ChrisPartridge: http://pastebin.com/VGYKj85b something like this, minus my mistakes 
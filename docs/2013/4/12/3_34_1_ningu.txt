I must be missing something, another set of eyes could help: http://hastebin.com/vayipivupo.coffee
I just jumped into gist and converted this to JS by hand so that you didn't have to read CS's generated coffeescript
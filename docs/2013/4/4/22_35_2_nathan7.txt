a promise wrapper around all this would kick ass
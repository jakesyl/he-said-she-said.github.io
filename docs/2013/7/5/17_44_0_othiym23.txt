oren: if you want an alternative to if (err) {}, take a look at domain.intercept: http://nodejs.org/api/domain.html#domain_domain_intercept_callback
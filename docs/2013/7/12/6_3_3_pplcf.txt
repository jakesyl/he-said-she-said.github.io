how to make synchronous error tolerant function queue?
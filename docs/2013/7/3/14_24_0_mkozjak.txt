how to check if the socket is opened before writing to it?
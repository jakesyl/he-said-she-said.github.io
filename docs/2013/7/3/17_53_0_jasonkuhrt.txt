this part looks bad: https://gist.github.com/jasonkuhrt/30a8db7d2104d1bd32fb#file-session-L34-L36
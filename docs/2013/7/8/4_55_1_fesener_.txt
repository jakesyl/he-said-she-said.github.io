and I've changed clients[user.username] = user.username to clients[user.username] = { 'socketid': socket.id, 'userid':user.userid }; and everything seems to be working without changing anything else
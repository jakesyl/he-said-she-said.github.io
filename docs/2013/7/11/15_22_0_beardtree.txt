Is there a better way to write this? https://gist.github.com/beardtree/f89e907019077b2ba9c7
actual promises + generators would be nice